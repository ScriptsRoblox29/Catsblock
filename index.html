<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CatsBlock iOS 26</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --bg-black: #000000;
            --ios-card-bg: #1c1c1e;
            --ios-blue: #007AFF;
            --ios-red: #ff3b30;
            --ios-grey: #8e8e93;
            --sent-gradient: linear-gradient(180deg, #007AFF 0%, #0056B3 100%);
            --received-bg: #262629;
            --blur-header: rgba(28, 28, 30, 0.85);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            background-color: var(--bg-black);
            color: white; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif;
            overflow: hidden;
        }

        /* --- NAVIGATION CONTROL --- */
        .app-view { display: none; height: 100vh; width: 100%; flex-direction: column; position: absolute; }
        .app-view.active { display: flex; }

        /* --- LOADING STATE --- */
        #view-loading { justify-content: center; align-items: center; z-index: 1000; }
        .ios-loader {
            width: 35px; height: 35px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid var(--ios-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* --- LOGIN DESIGN --- */
        #view-login { justify-content: center; align-items: center; padding: 40px; text-align: center; }
        .login-container { animation: elasticIn 0.6s ease; }
        .btn-google {
            background: white; color: black; border: none; padding: 16px 28px;
            border-radius: 14px; font-weight: 600; font-size: 16px;
            display: flex; align-items: center; gap: 12px; cursor: pointer; margin: 30px auto;
            transition: transform 0.2s;
        }
        .btn-google:active { transform: scale(0.95); }

        /* --- HEADER & LISTS --- */
        header {
            padding: 55px 20px 15px; background: var(--blur-header);
            backdrop-filter: blur(30px); border-bottom: 0.5px solid #38383a;
            display: flex; justify-content: space-between; align-items: center;
        }
        .skeleton-item {
            height: 75px; margin: 8px 15px; background: var(--ios-card-bg);
            border-radius: 15px; position: relative; overflow: hidden;
        }
        .skeleton-item::after {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.04), transparent);
            animation: shimmer 1.5s infinite;
        }

        /* --- CHAT BUBBLES --- */
        #chat-scroller { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .message-row { display: flex; flex-direction: column; max-width: 78%; }
        .row-sent { align-self: flex-end; align-items: flex-end; }
        .row-received { align-self: flex-start; align-items: flex-start; }

        .bubble {
            padding: 11px 16px; border-radius: 20px; font-size: 16px; line-height: 1.35;
            animation: elasticIn 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            word-wrap: break-word;
        }
        .bubble.sent { background: var(--sent-gradient); border-bottom-right-radius: 4px; box-shadow: 0 4px 15px rgba(0, 122, 255, 0.35); }
        .bubble.received { background: var(--received-bg); border-bottom-left-radius: 4px; }
        .msg-time { font-size: 10.5px; color: var(--ios-grey); margin-top: 5px; padding: 0 4px; }

        /* --- INPUT BAR --- */
        .input-container { padding: 10px 16px 36px; background: black; display: flex; align-items: flex-end; gap: 12px; }
        .textarea-box { flex: 1; background: var(--ios-card-bg); border-radius: 22px; padding: 6px 16px; border: 0.5px solid #38383a; }
        textarea {
            width: 100%; background: transparent; border: none; color: white;
            resize: none; font-size: 16px; max-height: 72px; padding: 8px 0; font-family: inherit;
        }

        /* --- BOTTOM NAV --- */
        .tab-bar {
            height: 88px; background: var(--blur-header); backdrop-filter: blur(30px);
            border-top: 0.5px solid #38383a; display: flex; justify-content: space-around; padding-top: 10px;
        }
        .tab-icon { color: var(--ios-grey); font-size: 22px; cursor: pointer; transition: 0.2s; }
        .tab-icon.active { color: var(--ios-blue); }

        /* --- IOS ALERTS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); display: none; justify-content: center;
            align-items: center; z-index: 2000; backdrop-filter: blur(6px);
        }
        .ios-modal {
            background: #1c1c1e; width: 280px; border-radius: 14px;
            text-align: center; animation: elasticIn 0.3s ease;
        }
        .modal-btn-group { display: flex; border-top: 0.5px solid #38383a; }
        .modal-btn { flex: 1; padding: 14px; border: none; background: transparent; color: var(--ios-blue); font-size: 17px; cursor: pointer; }
        .modal-btn.destructive { color: var(--ios-red); font-weight: 600; border-left: 0.5px solid #38383a; }

        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes shimmer { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        @keyframes elasticIn {
            0% { transform: scale(0.7); opacity: 0; filter: blur(8px); }
            100% { transform: scale(1); opacity: 1; filter: blur(0); }
        }
    </style>
</head>
<body>

    <div id="view-loading" class="app-view active">
        <div class="ios-loader"></div>
    </div>

    <div id="view-login" class="app-view">
        <div class="login-container">
            <h1 style="font-weight: 700; font-size: 28px;">Log in to access CatsBlock</h1>
            <button class="btn-google" id="google-auth-trigger">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" width="20">
                Continue with Google
            </button>
            <p style="font-size: 13px; color: var(--ios-grey); margin-top: 20px;">
                By continuing, you agree to our <br><a href="https://example.com/terms" style="color: var(--ios-blue); text-decoration: none;">terms of service</a>.
            </p>
        </div>
    </div>

    <div id="view-main" class="app-view">
        <header>
            <h1 style="font-size: 32px; font-weight: 700;">Messages</h1>
            <i class="fa-regular fa-pen-to-square" style="color: var(--ios-blue); font-size: 22px; cursor: pointer;" onclick="openNewConversation()"></i>
        </header>
        <div id="conversations-list" style="flex:1; overflow-y:auto;">
            </div>
        <nav class="tab-bar">
            <div class="tab-icon active"><i class="fa-solid fa-comment"></i></div>
            <div class="tab-icon"><i class="fa-solid fa-circle-user"></i></div>
        </nav>
    </div>

    <div id="view-chat" class="app-view">
        <header style="padding-top: 50px; justify-content: flex-start; gap: 15px;">
            <i class="fa-solid fa-chevron-left" style="color: var(--ios-blue); font-size: 20px; cursor:pointer;" onclick="navigateBack()"></i>
            <div style="flex:1; text-align: center; margin-right: 35px;">
                <div id="chat-contact-name" style="font-weight: 600; font-size: 17px;">Contact</div>
                <div style="font-size: 11px; color: var(--ios-grey);">iMessage</div>
            </div>
        </header>
        <div id="chat-scroller"></div>
        <div class="input-container">
            <div class="textarea-box">
                <textarea id="main-textarea" placeholder="iMessage" rows="1"></textarea>
            </div>
            <button id="btn-send" style="background: var(--ios-blue); border:none; width:32px; height:32px; border-radius:50%; color:white; font-size: 18px; cursor:pointer;">â†‘</button>
        </div>
    </div>

    <div id="modal-block" class="modal-overlay">
        <div class="ios-modal">
            <div style="padding: 20px 16px 8px; font-weight: 600;">Block this person?</div>
            <div style="padding: 0 16px 20px; font-size: 13px; color: var(--ios-grey);">Are you sure? They won't be notified.</div>
            <div class="modal-btn-group">
                <button class="modal-btn" onclick="toggleBlockModal(false)">Cancel</button>
                <button class="modal-btn destructive" onclick="handleUserBlock()">Block</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp, doc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDy6Ewsq2egkBrELp6i9rGLRnvdIYqOxeg",
            authDomain: "catsblock-94c61.firebaseapp.com",
            projectId: "catsblock-94c61",
            storageBucket: "catsblock-94c61.firebasestorage.app",
            messagingSenderId: "462618239829",
            appId: "1:462618239829:web:8c1445e69db9fc988585dc"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const views = {
            loading: document.getElementById('view-loading'),
            login: document.getElementById('view-login'),
            main: document.getElementById('view-main'),
            chat: document.getElementById('view-chat')
        };

        function setView(viewId) {
            Object.values(views).forEach(v => v.classList.remove('active'));
            views[viewId].classList.add('active');
        }

        document.getElementById('google-auth-trigger').onclick = async () => {
            try { await signInWithPopup(auth, provider); } 
            catch (err) { console.error("Login Error:", err); }
        };

        onAuthStateChanged(auth, (user) => {
            if (user) { bootstrapApp(); } 
            else { setView('login'); }
        });

        function bootstrapApp() {
            setView('main');
            const list = document.getElementById('conversations-list');
            list.innerHTML = Array(10).fill('<div class="skeleton-item"></div>').join('');
            
            setTimeout(() => {
                list.innerHTML = `<div style="text-align:center; padding:60px; color:var(--ios-grey); font-size: 15px;">
                    No conversation for now.<br>Click the pencil icon to start one!
                </div>`;
            }, 1800);
        }

        const textarea = document.getElementById('main-textarea');
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            const newHeight = Math.min(this.scrollHeight, 72);
            this.style.height = newHeight + 'px';
            this.style.overflowY = this.scrollHeight > 72 ? 'auto' : 'hidden';
        });

        async function postMessage() {
            const rawText = textarea.value.trim();
            if (rawText.length < 1 || rawText.length > 300) return;

            const messagePayload = {
                sender: auth.currentUser.uid,
                content: rawText,
                createdAt: serverTimestamp(),
                status: 'sending'
            };

            renderBubble({ ...messagePayload, createdAt: null }, 'sent');
            textarea.value = "";
            textarea.style.height = 'auto';
            // Firebase addDoc logic would go here
        }

        function renderBubble(data, mode) {
            const scroller = document.getElementById('chat-scroller');
            const row = document.createElement('div');
            row.className = `message-row row-${mode}`;
            const timeString = data.createdAt ? "Now" : "...";
            row.innerHTML = `<div class="bubble ${mode}">${data.content}</div><div class="msg-time">${timeString}</div>`;
            scroller.appendChild(row);
            scroller.scrollTop = scroller.scrollHeight;
        }

        document.getElementById('btn-send').onclick = postMessage;
        window.navigateBack = () => setView('main');
        window.toggleBlockModal = (show) => {
            document.getElementById('modal-block').style.display = show ? 'flex' : 'none';
        };
    </script>
</body>
</html>
